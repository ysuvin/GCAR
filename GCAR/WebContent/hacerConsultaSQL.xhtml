<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:body>
	
	<f:metadata>
		<f:event listener="#{newLoginBean.loadBD}" type="preRenderView" />
	</f:metadata>
	
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"/>
	<ui:composition template="/templates/consultaTemplate.xhtml">
		<ui:define name="title">Algebra Relacional - UV</ui:define>
		<ui:define name="content">
		
			<h:form>			
				<p:panel styleClass="divs">
					<h:panelGrid columns="3" cellpadding="5">
						<h:commandLink value="Inicio" styleClass="linkTitulo" action="home"/>
						>
						<h:outputText value="Hacer Consulta SQL" styleClass="tituloPagina"/>
					</h:panelGrid>
				</p:panel>
			</h:form>
			
			<p:spacer/>
			
			<h:form id="form" onkeypress="if (event.keyCode == 13) {return false; }">
				<p:growl id="growl" showDetail="false"/>
				
				<p:dialog id="help" widgetVar="dlg" header="Ayuda" resizable="false" showEffect="fade" hideEffect="fade">
					<p:fieldset legend="Hacer Consulta SQL" style="font-weight: bold;" >
						<h2/>
						1. El nombre de las <h:outputText value="Relaciones" style="color:#e69700"/> de la Base de Datos cargada, adem&#225;s de las <h:outputText value="Relaciones Auxiliares" style="color:#e69700"/> generadas en cada consulta, se muestran a la Izquierda de la pantalla <p/>
						2. Luego de ingresar la consulta, seleccione el bot&#243;n <p:commandButton value="Ejecutar" icon="ui-icon-check" readonly="true" /> para ejecutar la consulta SQL <p/>
						3. En la secci&#243;n <p:commandButton value="Historial" readonly="true" /> se guarda el Historial de consultas realizadas <p/>
						<h2/>
					</p:fieldset>
			    </p:dialog>  
			    
				<p:fieldset styleClass="divs">
				<f:facet name="legend">
					<h:panelGrid columns="2" cellpadding="5">
						<h:outputText value="Hacer Consulta SQL" />
						<h:outputLink value="javascript:void(0)" onclick="PF('dlg').show();" >
							<span class="ui-icon ui-icon-help" />
						</h:outputLink>
					</h:panelGrid>
				</f:facet>
				
				<p:panel id="tablaPanel" style="height:250px!important" header="Resultado">
				<p:dataTable value="#{dtGestionarEjerciciosBeanSQL.data}" scrollable="true" scrollHeight="150" var="item" style="width:100%!important;"
					emptyMessage="Ingrese su consulta en SQL"> 
					<f:facet name="header">
						<h:outputText value="#{dtGestionarEjerciciosBeanSQL.tableName}" />
					</f:facet>
    				<p:columns value="#{dtGestionarEjerciciosBeanSQL.columnNames}" var="columnName" columnIndexVar="i"> 
        				<f:facet name="header">
        					<h:outputText value="#{columnName}"/>
        				</f:facet>
        				<h:outputText value="#{item[i] != null ? item[i] : 'Nulo'}"/>
    				</p:columns> 
				</p:dataTable>
				</p:panel>
				
				<p:spacer/> 
							
				<p:panel header="Consultas" id="consultaPanel" mode="native" style="margin:0 auto !important;">	
				<p:toolbar>
					<f:facet name="left">
						<p:commandButton type="push" title="Select" value="SELECT" 
							action="#{dtGestionarEjerciciosBeanSQL.ayudaSelect}" update="form" ajax="true"/>
							
						<p:commandButton type="push" title="From" value="FROM"
							action="#{dtGestionarEjerciciosBeanSQL.ayudaFrom}" update="form" ajax="true"/>
							
						<p:commandButton type="push" title="Where" value="WHERE"
							action="#{dtGestionarEjerciciosBeanSQL.ayudaWhere}" update="form" ajax="true"/>
							
						<p:commandButton type="push" title="Distinct" value="DISTINCT"
							action="#{dtGestionarEjerciciosBeanSQL.ayudaDistinct}" update="form" ajax="true"/>
							
						<p:commandButton type="push" title="Orderby" value="ORDER BY"
							action="#{dtGestionarEjerciciosBeanSQL.ayudaOrderby}" update="form" ajax="true"/>
							
						<p:commandButton type="push" title="Groupby" value="GROUP BY"
							action="#{dtGestionarEjerciciosBeanSQL.ayudaGroupby}" update="form" ajax="true"/>
							
						<p:commandButton type="push" title="Having" value="HAVING"
							action="#{dtGestionarEjerciciosBeanSQL.ayudaHaving}" update="form" ajax="true"/>
							
						<p:commandButton type="push" title="Join" value="JOIN"
							action="#{dtGestionarEjerciciosBeanSQL.ayudaJoin}" update="form" ajax="true"/>
							
									
					</f:facet>
				</p:toolbar>
				
				<h:panelGrid columns="2" style="width:100%">
					<p:inputText size="150" style="width:95%" id="query" value="#{dtGestionarEjerciciosBeanSQL.query}"/>
					<p:commandButton id="ejecutar" type="push" title="Ejecutar" value="Ejecutar" ajax="true" 
						action="#{dtGestionarEjerciciosBeanSQL.ejecutar}" icon="ui-icon-check" update="form :formDataList"/>	
				</h:panelGrid>
				
				<p:spacer/>
							
				<p:fieldset legend="Historial">
				
				<p:scrollPanel mode="native" style="height:200px" styleClass="divs">		
					<p:inputTextarea rows="10" style="width:98%" id="grupoConsultas" disabled="false" value="#{dtGestionarEjerciciosBeanSQL.queryList}"/>				
				</p:scrollPanel>
				
				</p:fieldset>
				
							
				</p:panel>
				</p:fieldset>
			
			</h:form>
					
		</ui:define>
	</ui:composition>

</h:body>
</html>